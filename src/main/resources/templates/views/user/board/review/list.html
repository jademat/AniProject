<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user/layout.html}">

<th:block layout:fragment="content">
    <main id="content">
        <h2>입양후기 게시판</h2>
        <table class="table table-striped">
            <colgroup>
                <col style="width:7%">
                <col style="" class="truncate">
                <col style="width:12%">
                <col style="width:12%">
                <col style="width:7%">
                <col style="width:7%">
            </colgroup>

            <thead>
            <tr>
                <td colspan="3" class="text-start">
                    <div class="d-flex align-items-center gap-3">
                        <select class="form-select" style="width: 120px" id="findtype" name="findtype">
                            <option value="title" selected>제목</option>
                            <option value="userid">작성자</option>
                            <option value="contents">내용</option>
                        </select>
                        <input class="form-control" style="width: 250px" id="findkey" name="findkey" th:value="${param.findkey}">
                        <button class="btn btn-success" id="findbtn"><i class="fa-solid fa-magnifying-glass"></i> 검색</button>
                    </div>
                </td>
                <td colspan="3" class="text-end">
                    <!-- 로그인한 사용자만 글쓰기 버튼 보이게 -->
                    <th:block th:if="${userId != null}">
                        <button type="button" class="btn btn-primary" id="newbdbtn"><i class="fas fa-pen"></i> 글쓰기</button>
                    </th:block>
                </td>
            </tr>
            <tr class="table-light">
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성일</th>
                <th>추천</th>
                <th>조회</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="board : ${boardList}">
                <td th:text="${board.bdNo}"></td>
                <td>
                    <a th:href="@{/board/review/view/{bdNo}(bdNo=${board.bdNo})}" th:text="${board.bdTitle}"></a>
                </td>
                <td th:text="${board.userId}"></td>
                <td th:text="${board.bdRegdate}"></td>
                <td th:text="${board.bdThumbs}"></td>
                <td th:text="${board.bdViews}"></td>
            </tr>
            </tbody>

            <tfoot>
            <tr>
                <td colspan="6">
                    <ul class="pagination">
                        <li class="page-item">
                            <a href="#" class="page-link">이전</a>
                        </li>
                        <li class="page-item active">
                            <a href="#" class="page-link">1</a>
                        </li>
                        <li class="page-item">
                            <a href="#" class="page-link">다음</a>
                        </li>
                    </ul>
                </td>
            </tr>
            </tfoot>

        </table>
    </main>
</th:block>

<th:block layout:fragment="script">
    <script>
        document.querySelector("#newbdbtn")?.addEventListener('click', () => {
            let userId = "[[${userId}]]";  // Thymeleaf에서 세션 값 가져오기

            if (!userId) {  // 로그인 안 되어 있으면 로그인 페이지로 이동
                alert("로그인이 필요합니다.");
                location.href = "/login";
            } else {
                location.href = "/board/review/write";  // 로그인 상태면 글쓰기 페이지로 이동
            }
        });
    </script>
</th:block>

</html>
